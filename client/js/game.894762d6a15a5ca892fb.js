(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function n(e){var r=function(e,r){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,r||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==t(r)?r:r+""}e.d({},{d:()=>x});var i=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"load",value:function(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){return t(n)},n.onerror=function(e){return r(e)},n.src=e}))}}],(t=null)&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function s(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}var u=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},r=[{key:"calculateNormals",value:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=0;for(var i=0;i<t.length;i+=3){var o=[],a=[],s=[];o[0]=e[3*t[i+1]+0]-e[3*t[i]+0],o[1]=e[3*t[i+1]+1]-e[3*t[i]+1],o[2]=e[3*t[i+1]+2]-e[3*t[i]+2],a[0]=e[3*t[i+2]+0]-e[3*t[i+1]+0],a[1]=e[3*t[i+2]+1]-e[3*t[i+1]+1],a[2]=e[3*t[i+2]+2]-e[3*t[i+1]+2],s[0]=o[1]*a[2]-o[2]*a[1],s[1]=o[2]*a[0]-o[0]*a[2],s[2]=o[0]*a[1]-o[1]*a[0];for(var u=0;u<3;u++)r[3*t[i+u]+0]=r[3*t[i+u]+0]+s[0],r[3*t[i+u]+1]=r[3*t[i+u]+1]+s[1],r[3*t[i+u]+2]=r[3*t[i+u]+2]+s[2]}for(var l=0;l<e.length;l+=3){var c=[];c[0]=r[l+0],c[1]=r[l+1],c[2]=r[l+2];var f=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);0==f&&(f=1e-5),c[0]=c[0]/f,c[1]=c[1]/f,c[2]=c[2]/f,r[l+0]=c[0],r[l+1]=c[1],r[l+2]=c[2]}return r}},{key:"getShader",value:function(e,t){var r=document.getElementById(t);if(!r)return null;for(var n,i="",o=r.firstChild;o;)3==o.nodeType&&(i+=o.textContent),o=o.nextSibling;if("x-shader/x-fragment"==r.type)n=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=r.type)return null;n=e.createShader(e.VERTEX_SHADER)}if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n));return n}},{key:"createCanvas",value:function(e,t,r){var n=document.createElement("canvas");return n.id=e,t.appendChild(n),n.width=r.w,n.height=r.h,n}},{key:"getGLContext",value:function(e){var t=null;if(null==e)throw new Error("there is no canvas on this page");for(var r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<r.length;++n){try{t=e.getContext(r[n])}catch(e){throw new Error(e)}if(t)break}if(null==t)throw new Error("Could not initialise WebGL");return t}}],(t=null)&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==l(t)?t:t+""}var h=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"create",value:function(e,t){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),r}}])&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function y(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==m(t)?t:t+""}var d=function(){return e=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvasSize=r,this.holder=n,this.shader=i,this.setCurrentTexture(t),this.init()},(t=[{key:"init",value:function(){var e=u.createCanvas("webgl-canvas",this.holder,this.canvasSize);this.gl=u.getGLContext(e),this.texture=(new h).create(this.gl,this.getCurrentTexture()),this.setupVerticesAndTexture(),this.configureShader(this.shader),this.setupAttributesAndUniform(),this.renderLoop()}},{key:"setupVerticesAndTexture",value:function(){this.vertexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),this.gl.STATIC_DRAW),this.textureBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,0,0,1,1,1,0]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}},{key:"configureShader",value:function(e){var t=this.gl,r=u.getShader(t,"post-common-vs"),n=u.getShader(t,e);if(this.shaderPostProcess&&t.deleteProgram(this.shaderPostProcess),this.shaderPostProcess=t.createProgram(),t.attachShader(this.shaderPostProcess,r),t.attachShader(this.shaderPostProcess,n),t.linkProgram(this.shaderPostProcess),!t.getProgramParameter(this.shaderPostProcess,t.LINK_STATUS))throw new Error("Could not initialise post-process shader");this.shaderPostProcess.aVertexPositionTexture=t.getAttribLocation(this.shaderPostProcess,"aVertexPositionTexture"),this.shaderPostProcess.aVertexTextureCoords=t.getAttribLocation(this.shaderPostProcess,"aVertexTextureCoords"),this.shaderPostProcess.uSampler=t.getUniformLocation(this.shaderPostProcess,"uSampler"),this.shaderPostProcess.uSamplerChroma=t.getUniformLocation(this.shaderPostProcess,"uSamplerChroma")}},{key:"setupAttributesAndUniform",value:function(){this.gl.useProgram(this.shaderPostProcess),this.gl.enableVertexAttribArray(this.shaderPostProcess.aVertexPositionTexture),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(this.shaderPostProcess.aVertexPositionTexture,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.shaderPostProcess.aVertexTextureCoords),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureBuffer),this.gl.vertexAttribPointer(this.shaderPostProcess.aVertexTextureCoords,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textureChroma);var e=this.gl.getUniformLocation(this.shaderPostProcess,"uSampler"),t=this.gl.getUniformLocation(this.shaderPostProcess,"uSamplerChroma");this.gl.uniform1i(e,0),this.gl.uniform1i(t,1)}},{key:"draw",value:function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.getCurrentTexture()),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}},{key:"setCurrentTexture",value:function(e){this.currentTexture=e}},{key:"getCurrentTexture",value:function(){return this.currentTexture}},{key:"updateTexture",value:function(e){this.setCurrentTexture(e)}},{key:"renderLoop",value:function(){x(this.renderLoop.bind(this)),this.draw()}}])&&v(e.prototype,t),r&&v(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function p(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:t+""}var w=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.create(t)},(t=[{key:"create",value:function(e){this.view=document.createElement("video"),this.view.setAttribute("autoplay","true"),this.view.id="videoElement",e.appendChild(this.view)}},{key:"connect",value:function(){var e=this;return new Promise((function(t,r){e.view.onloadedmetadata=function(){this.view.play(),t(this.view)}.bind(e),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{width:320,height:240}}).then(e.addStream.bind(e)).catch((function(){return r("Webcam not found, please, check your hardware and try again.")})):r("Please try from another device.")}))}},{key:"addStream",value:function(e){"srcObject"in this.view?this.view.srcObject=e:this.view.src=window.URL.createObjectURL(e)}}])&&g(e.prototype,t),r&&g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,E(n.key),n)}}function E(e){var t=function(e,t){if("object"!=P(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=P(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==P(t)?t:t+""}var S=function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=[],this.containerElement=document.querySelector("#container"),i.load("images/color.jpg").then((function(e){t.setupViews(e)})).catch((function(e){t.logError(e)}))},(t=[{key:"setupViews",value:function(e){this.view.push(new d(e,{w:320,h:240},this.containerElement,"channel-red")),this.view.push(new d(e,{w:320,h:240},this.containerElement,"channel-green")),this.view.push(new d(e,{w:320,h:240},this.containerElement,"channel-blue")),this.initVideo()}},{key:"initVideo",value:function(){var e=this;new w(document.querySelector("#container")).connect().then((function(t){e.updateViewsTexture(t)})).catch((function(t){e.logError(t)}))}},{key:"updateViewsTexture",value:function(e){this.view.forEach((function(t){return t.updateTexture(e)}))}},{key:"logError",value:function(e){alert(e)}}])&&T(e.prototype,t),r&&T(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}();window,void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(r,n){t.call(navigator,e,r,n)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),window.addEventListener("DOMContentLoaded",(function e(){new S,window.removeEventListener("DOMContentLoaded",e)}));var x=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}})();